<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Kushal K Dey" />


<title>Testing distrom and speed of multinomial fit</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">singlecell-clustering</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jdblischak/workflowr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Testing distrom and speed of multinomial fit</h1>
<h4 class="author"><em>Kushal K Dey</em></h4>
<h4 class="date"><em>9/5/2017</em></h4>

</div>


<p>In this script, we test the <strong>distrom</strong> package due to Matt Taddy (UChicago Booth School) for fitting multinomial regression models in a distributed fashion. We take examples of counts matrices of different scales - small sample size (number of rows) and small number of features (number of columns), large sample size and small numbe rof features, small sample size and large number of features and finally with both large samples and large number of features. We discuss scalability issues for each of these cases.</p>
<pre class="r"><code>library(distrom)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loading required package: gamlr</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre class="r"><code>library(MASS)
library(parallel)</code></pre>
<div id="small-sample-size-small-number-of-features" class="section level2">
<h2>small sample size, small number of features</h2>
<p>We define <code>covars</code> to be a matrix of covariate information for each sample. So, this is a mtrix with samples along the rows and covariates along the columns.</p>
<pre class="r"><code>cl &lt;- makeCluster(parallel::detectCores(),type=ifelse(.Platform$OS.type==&quot;unix&quot;,&quot;FORK&quot;,&quot;PSOCK&quot;))
print(cl)</code></pre>
<pre><code>## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre class="r"><code>covars &lt;- do.call(rbind, replicate(1, fgl[,1:9], simplify=FALSE))
dim(covars)</code></pre>
<pre><code>## [1] 214   9</code></pre>
<pre class="r"><code>head(covars)</code></pre>
<pre><code>##      RI    Na   Mg   Al    Si    K   Ca Ba   Fe
## 1  3.01 13.64 4.49 1.10 71.78 0.06 8.75  0 0.00
## 2 -0.39 13.89 3.60 1.36 72.73 0.48 7.83  0 0.00
## 3 -1.82 13.53 3.55 1.54 72.99 0.39 7.78  0 0.00
## 4 -0.34 13.21 3.69 1.29 72.61 0.57 8.22  0 0.00
## 5 -0.58 13.27 3.62 1.24 73.08 0.55 8.07  0 0.00
## 6 -2.04 12.79 3.61 1.62 72.97 0.64 8.07  0 0.26</code></pre>
<p>We assume there are 100 categories in the multinomial model fit, in covtpx, this would be equivalent to the number of features (genes).</p>
<pre class="r"><code>counts &lt;- matrix(sample(1:100, 214*100, replace=TRUE), 214, 100)
dim(counts)</code></pre>
<pre><code>## [1] 214 100</code></pre>
<pre class="r"><code>counts[1:5,1:5]</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]   46   33   11   14   30
## [2,]   80   68   76    1   98
## [3,]   28   36   88   95   74
## [4,]   93    4   82   14   83
## [5,]   41   54   95   48   76</code></pre>
<pre class="r"><code>system.time(fits &lt;- dmr(cl, covars, counts, verb=1))</code></pre>
<pre><code>## fitting 214 observations on 100 categories, 9 covariates.
## converting counts matrix to column list...
## distributed run.
## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre><code>##    user  system elapsed 
##   0.026   0.007   0.369</code></pre>
<pre class="r"><code>stopCluster(cl)</code></pre>
<p>We can then get the estimated coefficients as follows</p>
<pre class="r"><code>fitted_coeff &lt;- coef(fits)</code></pre>
<pre><code>## Warning in `[&lt;-`(`*tmp*`, sapply(B, is.null), value = &lt;S4 object of class
## structure(&quot;dsCMatrix&quot;, package = &quot;Matrix&quot;)&gt;): implicit list embedding of S4
## objects is deprecated</code></pre>
<pre class="r"><code>dim(fitted_coeff)</code></pre>
<pre><code>## [1]  10 100</code></pre>
<pre class="r"><code>head(fitted_coeff)</code></pre>
<pre><code>## 6 x 100 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##    [[ suppressing 100 column names &#39;1&#39;, &#39;2&#39;, &#39;3&#39; ... ]]</code></pre>
<pre><code>##                                                                          
## intercept  3.91589047 -4.823430457 -39.02433554 -5.049024287 -1.569198686
## RI        -0.03519913 -0.006464603   0.05327502  0.005832053  .          
## Na         0.03067218  .             0.33350505  .           -0.006033058
## Mg        -0.07459479 -0.021095517   0.29622637 -0.053711015  0.025039718
## Al        -0.16701658 -0.195499707   0.40438857 -0.105231792 -0.115132398
## Si        -0.11755551  0.007965369   0.36222415  0.010314117 -0.039314041
##                                                                          
## intercept -35.00864780 -4.6788916871  5.73749788 -10.37807117 -6.50700941
## RI          0.02345999  0.0269329822  0.06881119   0.06205661 -0.11340845
## Na          0.27108840 -0.0010575536 -0.19871241   .           0.03547900
## Mg          0.23584904  0.0358665928 -0.20162289   0.02917041  0.13223038
## Al          0.39326807  .            -0.08490908   0.17868630 -0.19272061
## Si          0.32632829 -0.0007889359 -0.05825483   0.08331986 -0.01581992
##                                                                          
## intercept 33.36237496 -23.153079032 -5.448896090 -18.72281113 -9.48518848
## RI         0.02121559   0.009416634  0.007522169   0.03036375 -0.02414760
## Na        -0.38711541   0.140402199  0.085075282   0.01982928  0.11663325
## Mg        -0.44941395   0.157902474  .             0.03553605  0.03979504
## Al        -0.40285331   0.189708884 -0.054344492   0.04547364  0.01282306
## Si        -0.36677195   0.198738213  .             0.18792121  0.04169403
##                                                                         
## intercept 19.718220779 -7.29270040 -0.492397440 15.490894301 -4.82972419
## RI         0.002991759 -0.07043067  .            0.002328758  0.01106995
## Na        -0.148423433  0.19075183 -0.005247074 -0.129070113  .         
## Mg        -0.240811877  0.11087412  .           -0.146366468  .         
## Al        -0.191548113  .           0.093325423  0.006406770 -0.07303547
## Si        -0.264725462 -0.02757939 -0.057235065 -0.227876948  .         
##                                                                          
## intercept 12.23087071 -48.028992805 -11.55954990 -18.36978281  0.87286099
## RI         0.01069973  -0.000718886  -0.02182363  -0.02225716 -0.07532672
## Na        -0.21710171   0.467607362   .            0.14019076 -0.03953462
## Mg        -0.24177973   0.467377893   0.24543686   0.20974260  .         
## Al        -0.28777387   0.593266307   0.21429103   0.14732651 -0.10518418
## Si        -0.14690015   0.416979192   0.05574761   0.11897861 -0.08403541
##                                                                        
## intercept -25.76451325  0.46229721 -6.19322100  7.77828045 -1.254455370
## RI         -0.01411353 -0.01512999  .           .          -0.017637953
## Na          0.16805539 -0.07924758  0.02838286 -0.02285061 -0.040712380
## Mg          0.24686590 -0.08401921  .           0.01150494  .          
## Al          0.17454660 -0.25883883  0.03204328  0.06339330  0.009420742
## Si          0.21818045 -0.03204234  0.02206766 -0.16598812 -0.039788742
##                                                                         
## intercept -10.414750108 -0.705789824 -6.94721632 -2.35058052  1.99680681
## RI         -0.005615423  .            0.01710607  0.03394016 -0.03156284
## Na          .           -0.087912494  0.03670314  .           .         
## Mg          0.077654040  0.007449785 -0.01343955 -0.02023445 -0.01848956
## Al         -0.011869032  0.085490808 -0.01000374  0.13965435 -0.01649294
## Si          0.064276184 -0.036178758  0.02517607 -0.01867415 -0.08865964
##                                                                         
## intercept -2.893376051 -7.10767024 -10.92330787 12.92557205 -16.41075659
## RI         0.009108124 -0.04466332   0.02591172  0.04581126   0.02797991
## Na        -0.066872872  0.02188597  -0.01141604 -0.09414542  -0.01333688
## Mg         .            0.10328362   .          -0.23447513   .         
## Al         0.060403938  0.31465000   0.09899270 -0.13415656   0.18051962
## Si        -0.009514303  .            0.08730080 -0.18039331   0.16145849
##                                                                          
## intercept -8.257558462 -12.94619971 -5.565195677 23.86304143 -11.42255555
## RI         0.005929057   0.07305315 -0.053978244 -0.02664638  -0.02097225
## Na         .            -0.02909360  0.005443354 -0.19785278   0.11081043
## Mg         .             0.01345004  0.015101215 -0.24428958   0.13717981
## Al         0.058047260  -0.03782436 -0.231516486 -0.25748147   0.01659525
## Si         0.049016866   0.13368796  .           -0.31298729   0.04946897
##                                                                           
## intercept -1.159106471 -8.23361757  6.425373489 -58.98371183 -12.282976864
## RI         .            0.01357490  0.006012697  -0.02431934   0.035510051
## Na        -0.139323883 -0.08691924 -0.134042530   0.62969330  -0.001745009
## Mg         0.004627568  .          -0.089470113   0.64021308   .          
## Al        -0.032790153  0.04380590  .             0.62389810   0.148785739
## Si        -0.020089384  0.06275273 -0.103651351   0.51270442   0.106826439
##                                                                       
## intercept -3.10886527 -19.43709133 -6.51967638 13.87256474  4.76460855
## RI         0.04904796   0.02187035  0.01842370 -0.10120836  0.01009295
## Na        -0.03599401   0.12846051  .          -0.08222024 -0.01735818
## Mg        -0.05656007   0.15192480 -0.03143715  .           .         
## Al         0.18157663   0.33012283  0.05768226 -0.02955129  0.04111168
## Si         .            0.15937841  0.03149974 -0.25060810 -0.12334574
##                                                                        
## intercept -2.97635467 35.760894003 -9.45132407 -6.58648110 -4.116422626
## RI        -0.03046406  0.002052731  0.05778431  .           0.052207690
## Na         .          -0.347222913  0.07687691  0.01030300  0.075881474
## Mg         0.02507135 -0.407114569  .           .           0.006916105
## Al        -0.01492105 -0.479898743  0.08808008  .           0.028202291
## Si        -0.03292873 -0.415049945  0.05954252  0.02474069 -0.014053362
##                                                                          
## intercept -6.309026235 -10.995281960 -5.04310239 -3.553447682 -3.40293591
## RI         0.069941776  -0.009452867 -0.01468503  0.006731163 -0.01489395
## Na         .            -0.068215018 -0.06000946  0.047218268  0.07697284
## Mg         0.003431095  -0.047549004 -0.01176639  .            .         
## Al         0.169006341  -0.238518301  .          -0.045529288  0.04883335
## Si         0.033988883   0.106414934  0.01352554 -0.014488253 -0.03108464
##                                                                        
## intercept  5.24101383  0.61168396 -12.07502625 -6.72554731 -38.40303492
## RI        -0.05619149 -0.03981297  -0.03803308  .           -0.03830403
## Na        -0.05075107  0.09929325   0.01866656 -0.06000783   0.29144805
## Mg         .          -0.02762014   0.07946673 -0.02731176   0.37227239
## Al        -0.04308992 -0.07997731   0.10651503  .            0.33998986
## Si        -0.12951836 -0.09519582   0.07127264  0.04024476   0.33704018
##                                                                        
## intercept -2.121264647 -8.04667829 -17.54218747 21.75046608 -3.82374195
## RI         0.014522321 -0.01335773  -0.02225233  0.01660503  0.04490502
## Na        -0.131007565 -0.01744779   0.10603726 -0.25808901  0.00652233
## Mg         .            0.04383275   0.14259024 -0.23311389  .         
## Al         0.177321485 -0.03919623  -0.02682951 -0.12497710  0.19132621
## Si        -0.003774062  0.04906695   0.13504884 -0.26631960  .         
##                                                                          
## intercept -11.33334125 -10.76370017 -3.99194257 -4.274107890 -13.59846205
## RI          .            0.00960114 -0.03519092  0.029228674  -0.02302184
## Na          0.12177304   0.09659675  .           0.023992688   0.08846053
## Mg         -0.02703582   0.05305253 -0.03801703  .             0.03672287
## Al         -0.13210712  -0.02929810 -0.38404188  .            -0.08399666
## Si          0.07208829   0.06169743  .          -0.002674357   0.09979215
##                                                                        
## intercept -2.83862857 -41.18811639 -2.60210285 -21.93522147  3.91563096
## RI         0.01780173  -0.04269789  0.03030591   0.04903002 -0.05778173
## Na        -0.03306635   0.34386485 -0.07822017   0.02890134 -0.01384914
## Mg        -0.11433013   0.39523385  .            0.09499949 -0.03010594
## Al         0.08626233   0.58178810  0.08915972   0.27716606 -0.13164847
## Si         .            0.35438844 -0.01210044   0.22361262 -0.11837979
##                                                                       
## intercept  7.00488380 13.74616757 -8.766600178  9.00671685 -4.62000675
## RI        -0.05789384 -0.06131568 -0.006045724 -0.03093228  0.01201062
## Na        -0.06015560 -0.10798696  .           -0.12146967  .         
## Mg         .          -0.04219836 -0.013424646 -0.05594154  .         
## Al        -0.08082722 -0.15957042 -0.159450674 -0.19899210  .         
## Si        -0.14972703 -0.22779489  0.061022308 -0.15825987  .         
##                                                                        
## intercept 13.607388950  1.01148952 -8.03169303 -8.33119468 -15.14080422
## RI        -0.001810856  0.01246313 -0.05439740  0.03387281  -0.04970785
## Na        -0.181710264 -0.12814402  0.12184296  0.02950947   0.13211613
## Mg        -0.106380747  .           0.09032601  .            0.11755153
## Al        -0.177627523 -0.06030851  0.04028692 -0.02978534   .         
## Si        -0.195864921 -0.03890376  .           0.05649366   0.09657842
##                                                                          
## intercept -19.76757977 -3.383165890 -11.82565607 -0.430965630  2.85467445
## RI          0.04820337  .             0.10303929  0.041772769 -0.04112735
## Na          0.23217895 -0.058784340   0.07498295 -0.151512887 -0.13603623
## Mg          0.05293547  0.007185873   .          -0.184560973 -0.10181155
## Al          0.15102120  0.130295516   0.26089813 -0.174512572 -0.39823558
## Si          0.16418790 -0.009589916   0.09844719  0.006168477 -0.06635870</code></pre>
</div>
<div id="large-sample-size-small-number-of-features" class="section level2">
<h2>large sample size, small number of features</h2>
<pre class="r"><code>cl &lt;- makeCluster(parallel::detectCores(),type=ifelse(.Platform$OS.type==&quot;unix&quot;,&quot;FORK&quot;,&quot;PSOCK&quot;))
print(cl)</code></pre>
<pre><code>## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre class="r"><code>covars &lt;- do.call(rbind, replicate(100, fgl[,1:9], simplify=FALSE))
dim(covars)</code></pre>
<pre><code>## [1] 21400     9</code></pre>
<pre class="r"><code>head(covars)</code></pre>
<pre><code>##      RI    Na   Mg   Al    Si    K   Ca Ba   Fe
## 1  3.01 13.64 4.49 1.10 71.78 0.06 8.75  0 0.00
## 2 -0.39 13.89 3.60 1.36 72.73 0.48 7.83  0 0.00
## 3 -1.82 13.53 3.55 1.54 72.99 0.39 7.78  0 0.00
## 4 -0.34 13.21 3.69 1.29 72.61 0.57 8.22  0 0.00
## 5 -0.58 13.27 3.62 1.24 73.08 0.55 8.07  0 0.00
## 6 -2.04 12.79 3.61 1.62 72.97 0.64 8.07  0 0.26</code></pre>
<pre class="r"><code>counts &lt;- matrix(sample(1:100, 21400*100, replace=TRUE), 21400, 100)
dim(counts)</code></pre>
<pre><code>## [1] 21400   100</code></pre>
<pre class="r"><code>counts[1:5,1:5]</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]   37   25   38   30   75
## [2,]   27   19   31   36   16
## [3,]   73   47   55   84   11
## [4,]   47   33   89   73   49
## [5,]   35   17   93   35   47</code></pre>
<pre class="r"><code>system.time(fits &lt;- dmr(cl, covars, counts, verb=1))</code></pre>
<pre><code>## fitting 21400 observations on 100 categories, 9 covariates.
## converting counts matrix to column list...
## distributed run.
## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre><code>##    user  system elapsed 
##   0.481   0.162  10.165</code></pre>
<pre class="r"><code>stopCluster(cl)</code></pre>
<pre class="r"><code>coef(fits)</code></pre>
<pre><code>## Warning in `[&lt;-`(`*tmp*`, sapply(B, is.null), value = &lt;S4 object of class
## structure(&quot;dsCMatrix&quot;, package = &quot;Matrix&quot;)&gt;): implicit list embedding of S4
## objects is deprecated</code></pre>
<pre><code>## 10 x 100 sparse Matrix of class &quot;dmrcoef&quot;</code></pre>
<pre><code>##    [[ suppressing 100 column names &#39;1&#39;, &#39;2&#39;, &#39;3&#39; ... ]]</code></pre>
<pre><code>##                                                               
## intercept -4.0207545169 -3.370423781 -4.740120542 -4.458329047
## RI        -0.0049059224 -0.005969295  .           -0.003068947
## Na        -0.0016740077 -0.009536196  .           -0.003172780
## Mg        -0.0029693858  0.001379971  .            .          
## Al        -0.0164228660 -0.001596505 -0.007896644 -0.003118974
## Si        -0.0073183373 -0.015853200  0.001719186 -0.001950132
## K         -0.0114842425 -0.007345630  0.006620844  .          
## Ca         0.0008926285  0.005693326  0.002193670  0.004383943
## Ba         .             0.002321833 -0.007335942 -0.008175637
## Fe        -0.0323102178  0.014735659 -0.026368060  .          
##                                                               
## intercept -4.405588858 -5.5215977550 -4.314629336 -4.891439023
## RI         0.001074540  0.0040787791 -0.004126934  0.002478184
## Na        -0.002075407  0.0049305379  0.001179689 -0.001610337
## Mg        -0.001466120  0.0061316282  0.005332026  .          
## Al         0.008895729  0.0054772112  0.009872585  0.016270912
## Si        -0.001821592  0.0110791216 -0.005880467  0.003932597
## K         -0.013899325  0.0192890557  .           -0.003526739
## Ca        -0.004571791  0.0002338337  0.010831422  .          
## Ba        -0.004205453  0.0153869360 -0.011337874 -0.013567463
## Fe         0.054547761  0.0066926646 -0.046669672 -0.026065502
##                                                              
## intercept -4.682354665 -2.775120781 -3.880587969 -5.471994117
## RI        -0.001076935 -0.005551239  .            0.004949144
## Na         0.004718967 -0.015636357 -0.006002526  0.001184624
## Mg         0.006911540 -0.016659119  .            .          
## Al         0.006526916 -0.036040093  0.007315975 -0.004098742
## Si        -0.001128054 -0.019405974 -0.008884702  0.012498547
## K          .           -0.021434332 -0.002901633  0.007526685
## Ca         0.007740462 -0.011582203  .           -0.006490454
## Ba        -0.004755180  0.001549326 -0.014879009  0.005989289
## Fe         0.013844190  0.027384137  0.009217159 -0.045882944
##                                                                
## intercept -4.5927654744 -4.5257713717 -3.859072170 -4.940771931
## RI        -0.0006023361  0.0003960578 -0.003135853  0.001354832
## Na         0.0010415302  0.0076859592  0.006000444 -0.001981924
## Mg        -0.0049292791 -0.0052072122  .            0.003868416
## Al        -0.0167153671 -0.0068328920 -0.011897693  0.008838104
## Si         0.0004437551 -0.0021437460 -0.011653609  0.004665555
## K          .            -0.0038408491 -0.000903407  0.002926269
## Ca        -0.0022162749  .             0.004243846  .          
## Ba        -0.0072541999  0.0037832144  0.013842034  0.008168068
## Fe         0.0621924076  .             0.047187706  0.038220877
##                                                                
## intercept -5.6185526471 -4.7476807751 -2.935476583 -4.823515364
## RI         0.0078920499  .            -0.004001368  0.003124692
## Na        -0.0010754422  0.0008200861 -0.001508179  0.006416700
## Mg         0.0029247588 -0.0034415709  .            .          
## Al        -0.0005399118 -0.0053046165 -0.010733809 -0.004643518
## Si         0.0155126065  0.0019909457 -0.022343690  0.001775158
## K         -0.0011120483  0.0037900450 -0.010670466  0.016066898
## Ca        -0.0124433621  .             .            .          
## Ba         0.0036051847 -0.0078626209  0.003754685  .          
## Fe        -0.0136735951  0.0565694191  0.027292713 -0.030961081
##                                                                
## intercept -4.2424706633 -4.085522170 -4.597993867 -5.4045760774
## RI        -0.0045562644  .            0.002439964  0.0025867856
## Na         0.0009398105 -0.007002468 -0.003186620  0.0132655321
## Mg        -0.0005712237  .            .            .           
## Al        -0.0087945315  0.007036158  .           -0.0004740987
## Si        -0.0057101638 -0.006317104  0.000813075  0.0087734585
## K          0.0080898950  0.005052326 -0.006083904  0.0108825918
## Ca         0.0061556417  0.002836356 -0.002080865 -0.0032259807
## Ba         0.0097419318  0.006172446  .            0.0144889402
## Fe        -0.0607564146 -0.031539673 -0.078263838  0.0394870895
##                                                                           
## intercept -4.733119493 -4.196405189 -4.680377202 -4.919651217 -3.588973367
## RI         0.001724339 -0.003209223 -0.004319735 -0.001139225 -0.001771775
## Na         .           -0.001566814 -0.003509556 -0.002509617  .          
## Mg         0.003574604  .            0.004257241 -0.003039247  0.001137184
## Al        -0.009201501 -0.013956055  0.004622403  0.006730586  0.006634999
## Si         0.001688864 -0.005495790  .            0.004928209 -0.014147791
## K          0.008955970 -0.011658092 -0.013787687 -0.013983094 -0.003352992
## Ca         .            0.003683724  0.011993759  .            .          
## Ba         0.011827681  0.006478979  0.012938715 -0.024956460  .          
## Fe        -0.084277023  0.007270234 -0.016809674 -0.030424962  .          
##                                                               
## intercept -5.545246832 -5.374097341 -5.0750722966 -4.624594029
## RI         0.003820148  .            0.0058743958  0.001460425
## Na        -0.002065351 -0.005016167 -0.0018115914  0.001757112
## Mg         0.004777386  .            0.0003504413 -0.002418949
## Al         0.009391872 -0.002378886 -0.0022786699  0.006415348
## Si         0.012924313  0.011211963  0.0074741890  .          
## K          0.009561790 -0.005626216  0.0158662131 -0.009650654
## Ca         .            0.002985273 -0.0070457179  .          
## Ba        -0.007222473  0.009952531  0.0077441575  0.004896431
## Fe         0.010425053  0.009203046  0.0058630995 -0.102179972
##                                                               
## intercept -4.680315916 -4.7703530313 -5.011497430 -4.122452177
## RI         .           -0.0005119008  0.004190005  .          
## Na         0.003182676  0.0128322986  0.005003999  0.001910989
## Mg         0.002638320  0.0034089049  0.005347735 -0.003770025
## Al         0.023391641 -0.0073255560  0.023260154 -0.001344246
## Si         .            .             0.004007319 -0.006963007
## K         -0.013914843 -0.0004691957  0.002247931  0.010626124
## Ca         .            .             .            .          
## Ba        -0.009385660  .            -0.007959380 -0.011561451
## Fe         .            0.0102326975  0.013717205  0.054459511
##                                                                           
## intercept -4.829960524 -4.239190636 -4.811982168 -6.500056490 -4.455052804
## RI         0.002339719 -0.000838125  .            0.009270349  .          
## Na        -0.002005914 -0.007629413 -0.002843527  0.010472125  0.010565208
## Mg         0.002038113  0.001203683 -0.003579624  0.000740025 -0.003723994
## Al         .            .           -0.002768364  0.028934715  0.002413343
## Si         0.004079455 -0.003496741  0.003537143  0.024240336 -0.004726948
## K          .           -0.003883616  .            0.001134732  0.006738860
## Ca        -0.005350561 -0.001299580  .           -0.007610063  0.005979535
## Ba         0.010224389  0.008209616  0.006420018 -0.006602434 -0.013934893
## Fe        -0.047573952  .            .            0.082564024 -0.044629684
##                                                                 
## intercept -4.8706386121 -4.5240955585 -5.7563980500 -4.298639582
## RI        -0.0003987164 -0.0009941421  0.0015707927  .          
## Na         0.0019178931 -0.0076549288  .             0.006336196
## Mg         .            -0.0007724290  0.0095684414  0.001517233
## Al         0.0026483725  0.0087379644 -0.0004440627 -0.014289884
## Si         0.0031309586  .             0.0147844630 -0.005243092
## K          0.0169863530 -0.0028435630  0.0193151688  0.010416728
## Ca         .             0.0013394506  0.0038741542  .          
## Ba        -0.0133675920 -0.0052658540  0.0079592579  0.006130058
## Fe        -0.0237609412 -0.0259926730 -0.0027370667 -0.008127733
##                                                                 
## intercept -3.526866408 -3.6681202661 -4.7762474042 -4.7228707292
## RI         0.000638096 -0.0045440600  .            -0.0021464055
## Na        -0.005393732 -0.0087245524  0.0124950544  0.0077699857
## Mg        -0.008909727 -0.0007417402  .            -0.0029978398
## Al        -0.022037781 -0.0128768808  0.0068530704 -0.0024304308
## Si        -0.011556542 -0.0112199046  .             .           
## K          .           -0.0049452632  .            -0.0001764359
## Ca        -0.012191694  0.0014005467 -0.0010822342  0.0035302677
## Ba        -0.011802020  .             0.0002832011  .           
## Fe         0.053643078  0.0359915802  0.0139388681 -0.0577528965
##                                                               
## intercept -4.347866331 -4.6093202599 -3.789824085 -4.604326663
## RI        -0.004101647 -0.0017405151 -0.004101172  0.002045830
## Na        -0.004034729 -0.0018454474 -0.008953585  0.004802552
## Mg        -0.001695548 -0.0004727238 -0.000206422 -0.007250606
## Al         .            0.0245800936  .            0.004340865
## Si        -0.002863412  .            -0.010146432  .          
## K         -0.009825612 -0.0133732219 -0.009110708 -0.008104030
## Ca         0.002035011  .             0.005676446 -0.005038847
## Ba         0.011123584 -0.0218622392  0.005286160 -0.008979642
## Fe         0.038245069 -0.0102558278 -0.042241779  0.003755002
##                                                                
## intercept -4.7358015372 -5.533262318 -4.319520364 -5.7242736707
## RI        -0.0001662987  0.001865557  0.001455851  0.0018273563
## Na        -0.0026179544  0.006065148 -0.019448067  0.0064692057
## Mg         0.0017025942  0.003091834  0.004735588  0.0049798966
## Al        -0.0119292610 -0.012284307  0.013183133 -0.0007454168
## Si         0.0024634649  0.011833585  .            0.0138708526
## K          0.0009977753  0.015213251 -0.007456902  0.0046022800
## Ca         .            -0.001290961 -0.005621351  0.0007612267
## Ba         0.0101440240  0.010933238  0.011896429  0.0104830411
## Fe         0.0595747732 -0.041752644 -0.034043578 -0.0668622100
##                                                                 
## intercept -3.3228575791 -4.7996682986 -4.4102466105 -4.857238486
## RI        -0.0003958404 -0.0020817004 -0.0010194608  .          
## Na        -0.0090025254 -0.0057858567 -0.0002965423 -0.003339597
## Mg        -0.0053920180 -0.0008326798  .             0.001017434
## Al        -0.0169918891  .             0.0062792701  .          
## Si        -0.0139686537  0.0037789720 -0.0029646222  0.004110897
## K         -0.0063459598 -0.0083677065  .             .          
## Ca        -0.0122251869  0.0008621537  0.0027429696  .          
## Ba         0.0116757878  .            -0.0111941557 -0.003459171
## Fe        -0.0015725814  0.0318500854  0.0073828847  0.075865506
##                                                              
## intercept -4.514187545 -5.186909708 -4.672635427 -5.415572956
## RI        -0.002102938 -0.002435551  0.002399589  0.002638033
## Na        -0.008746276 -0.007530523  0.005366368  0.003400445
## Mg         .            .            .            .          
## Al         0.000763433  .           -0.002071019  .          
## Si         .            0.008588347  .            0.010605080
## K         -0.002208601  0.010463028  0.002530060  0.002842558
## Ca         0.003776615  0.006357003  .           -0.001185819
## Ba        -0.005612191  0.002431684 -0.006011441  .          
## Fe         0.015699214 -0.003833987 -0.032944308 -0.018399432
##                                                                 
## intercept -4.5755807988 -4.313447478 -5.0563114221 -4.6155088006
## RI         .             .            0.0013088826  0.0048856376
## Na         0.0003465672  .            0.0041788156  0.0078027445
## Mg         .             .            0.0047344351  0.0046570483
## Al         .             0.005632751  0.0160080690  0.0237282109
## Si         .            -0.004098020  0.0045339030 -0.0016305038
## K          0.0023262219  0.006565953  0.0006428507  0.0008322933
## Ca        -0.0026116305  .            0.0036598090 -0.0018900508
## Ba         0.0060090015  .            0.0019883844 -0.0047934402
## Fe         .             0.017831269 -0.0584888772 -0.0196652327
##                                                                
## intercept -4.331350765 -4.7395321658 -6.058640388 -5.6205575598
## RI         .           -0.0015398406  0.004930349  0.0025143821
## Na         .            .             0.007304984 -0.0016917223
## Mg         .           -0.0044508987  0.005615954  0.0003177992
## Al        -0.023746938  0.0136973704  0.007795584  0.0025349248
## Si        -0.003353936  0.0019711028  0.018346589  0.0148606613
## K          0.005998975 -0.0066297494  0.009454327  0.0041148278
## Ca         .           -0.0008119345 -0.001237002 -0.0054418294
## Ba         0.018850663 -0.0200513301 -0.008398679 -0.0154474236
## Fe         0.010096852  0.0520637999  0.024583486  0.0093816457
##                                                                
## intercept -4.592990524 -4.4028653753 -4.967877537 -4.4095476195
## RI         .            0.0003613321 -0.001662938  .           
## Na        -0.002949559 -0.0031235985  0.003925332  0.0131456378
## Mg        -0.001410512  .            -0.001513230 -0.0025384765
## Al         0.003492379 -0.0069428696 -0.026012334  .           
## Si         .           -0.0015764486  0.004855769 -0.0053433961
## K          .            0.0009683801  0.011598006  0.0004331586
## Ca         0.003173059 -0.0045595944  .            0.0029495603
## Ba         0.011168635  0.0159984436  0.002313147 -0.0129043272
## Fe        -0.020539427  0.0062737601  0.017158790  .           
##                                                                  
## intercept -3.2658224328 -4.3818929555 -4.6927568267 -4.3771527298
## RI        -0.0004335283  0.0007558556  0.0022208208  0.0009337127
## Na        -0.0130807442  0.0021340135  0.0073620747  .           
## Mg        -0.0147854648  .             0.0006643253  .           
## Al        -0.0179291548  0.0062147766 -0.0072039224  .           
## Si        -0.0136350538 -0.0032249849  .            -0.0030394486
## K         -0.0081288420  .            -0.0047081006 -0.0062222364
## Ca        -0.0123647307 -0.0022860359  .             .           
## Ba         0.0002029410 -0.0044716647 -0.0202060634  .           
## Fe         0.0362601873 -0.0101103429  0.0201150848 -0.0154672147
##                                                               
## intercept -3.7635575963 -3.570922440 -5.077061239 -4.975725367
## RI        -0.0080068664 -0.005386066  0.002130914  .          
## Na        -0.0058992565 -0.000586750  0.009617197 -0.004789537
## Mg        -0.0003088290  .            .           -0.003550619
## Al         0.0008581835 -0.008161201  0.015625439  0.007397893
## Si        -0.0117089425 -0.014614196  0.004088618  0.006067230
## K         -0.0113555892 -0.012870078  .           -0.004920265
## Ca         0.0104833816  0.005207029  0.003231715  .          
## Ba         0.0022440348  .           -0.017466926  0.007508235
## Fe         0.0389026623  0.023192702 -0.033971545 -0.098397756
##                                                                
## intercept -4.7454706593 -4.766335876 -4.7209727420 -3.361465435
## RI         .            -0.001061900  0.0021603599 -0.006824239
## Na        -0.0010073477 -0.001920411  0.0064735523 -0.005318339
## Mg         .            -0.002142940  0.0019022787  .          
## Al        -0.0060970611  .            .            -0.015376195
## Si         0.0023798071  0.002630660  0.0005554929 -0.017038576
## K          0.0007652369  0.015632412  0.0154944324  0.002291501
## Ca        -0.0016508835 -0.001382932 -0.0025644314  0.009665004
## Ba        -0.0023435159  0.005935685  0.0049347805  0.021604378
## Fe         0.0231435099  0.044714853  0.0328259781 -0.019948584
##                                                               
## intercept -5.296170233 -4.3277212806 -4.562556330 -5.361262391
## RI         0.003930445 -0.0036816582 -0.001689254  0.002084101
## Na         .           -0.0083505537 -0.003473117  0.001684440
## Mg         0.001833309  0.0009495149 -0.002629389  0.010433211
## Al        -0.001718822 -0.0071475718 -0.002138176  0.026050423
## Si         0.010038346 -0.0031225197  .            0.009182219
## K          0.001839958 -0.0121901741  0.001964007 -0.006705091
## Ca        -0.004738061  0.0071773665  0.001831978  .          
## Ba        -0.005774998  0.0200525947 -0.004192481  0.001240824
## Fe        -0.032486015 -0.0023372304  0.016950647  0.032430717
##                                                                
## intercept -4.3933318471 -4.686831163 -4.657068530 -5.0188113233
## RI        -0.0032180689  0.004910616  0.002056666  0.0028206609
## Na        -0.0029614959 -0.001258590  0.007015587  0.0105046737
## Mg         0.0029917464  .            .           -0.0009462293
## Al        -0.0036672014 -0.010003739  0.016640772  0.0217445354
## Si        -0.0024706512  0.002599181  .            0.0035902458
## K          .             0.002818050 -0.008308395  0.0034120945
## Ca        -0.0006374965 -0.009763339 -0.006959081 -0.0019903402
## Ba         0.0006780705  0.005658871 -0.026661745 -0.0235538518
## Fe         0.0314254569 -0.042125736  0.016006156  0.0379822558
##                                     
## intercept -4.678940798 -4.6708377439
## RI         0.003081132  .           
## Na        -0.001023118  .           
## Mg         .           -0.0014935012
## Al         0.009992381  .           
## Si         0.001053013  0.0006738959
## K         -0.003329416 -0.0026033867
## Ca         .            0.0016447266
## Ba         0.009125824  .           
## Fe        -0.014969389  .</code></pre>
</div>
<div id="small-sample-size-large-number-of-features" class="section level2">
<h2>small sample size, large number of features</h2>
<pre class="r"><code>cl &lt;- makeCluster(parallel::detectCores(),type=ifelse(.Platform$OS.type==&quot;unix&quot;,&quot;FORK&quot;,&quot;PSOCK&quot;))
print(cl)</code></pre>
<pre><code>## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre class="r"><code>covars &lt;- do.call(rbind, replicate(1, fgl[,1:9], simplify=FALSE))
dim(covars)</code></pre>
<pre><code>## [1] 214   9</code></pre>
<pre class="r"><code>head(covars)</code></pre>
<pre><code>##      RI    Na   Mg   Al    Si    K   Ca Ba   Fe
## 1  3.01 13.64 4.49 1.10 71.78 0.06 8.75  0 0.00
## 2 -0.39 13.89 3.60 1.36 72.73 0.48 7.83  0 0.00
## 3 -1.82 13.53 3.55 1.54 72.99 0.39 7.78  0 0.00
## 4 -0.34 13.21 3.69 1.29 72.61 0.57 8.22  0 0.00
## 5 -0.58 13.27 3.62 1.24 73.08 0.55 8.07  0 0.00
## 6 -2.04 12.79 3.61 1.62 72.97 0.64 8.07  0 0.26</code></pre>
<pre class="r"><code>counts &lt;- matrix(sample(1:100, 214*10000, replace=TRUE), 214, 10000)
dim(counts)</code></pre>
<pre><code>## [1]   214 10000</code></pre>
<pre class="r"><code>counts[1:5,1:5]</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]   56   20   82   32   45
## [2,]   13  100   68   11    3
## [3,]   32   93   90    9   40
## [4,]   12   77   15   66   53
## [5,]   26   94   69   41    6</code></pre>
<pre class="r"><code>system.time(fits &lt;- dmr(cl, covars, counts, verb=1))</code></pre>
<pre><code>## fitting 214 observations on 10000 categories, 9 covariates.
## converting counts matrix to column list...
## distributed run.
## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre><code>##    user  system elapsed 
##   1.778   0.562  29.724</code></pre>
<pre class="r"><code>stopCluster(cl)</code></pre>
<pre class="r"><code>coef(fits)</code></pre>
<pre><code>## Warning in `[&lt;-`(`*tmp*`, sapply(B, is.null), value = &lt;S4 object of class
## structure(&quot;dsCMatrix&quot;, package = &quot;Matrix&quot;)&gt;): implicit list embedding of S4
## objects is deprecated</code></pre>
<pre><code>## 10 x 10000 sparse Matrix of class &quot;dmrcoef&quot;</code></pre>
<pre><code>##    [[ suppressing 31 column names &#39;1&#39;, &#39;2&#39;, &#39;3&#39; ... ]]</code></pre>
<pre><code>##                                                                           
## intercept -6.75405585 -19.673862005 -1.969926e+01 -9.26240241 -10.33754131
## RI         .            0.012430946  3.233466e-02  .           -0.02545763
## Na         0.01636263   0.164551292  1.177594e-01  .            .         
## Mg         .            0.165753618  .             .           -0.04970448
## Al        -0.04103015   0.225070445  1.069071e-01 -0.02080608  -0.08117176
## Si        -0.03321263   0.097691308  1.205336e-01  .            0.01509920
## K          0.01998375   .            9.863015e-02  0.05331866  -0.07981804
## Ca        -0.02510375   0.036048923  3.282898e-04  .            0.03411987
## Ba         0.20289890  -0.001235647 -3.160837e-02  .            0.05307530
## Fe        -0.13289039   0.423461641  4.833382e-01  0.77920729   0.25891251
##                                                                          
## intercept -8.820592663 -16.40110274 -3.9395727164 -9.48421645 -5.60164103
## RI         0.007456071   0.04167536 -0.0171925380  0.00637491 -0.01505380
## Na         .            -0.01368010  0.0155346329  0.01930054 -0.03584767
## Mg         .             0.01710997  0.0008927696  0.03173391  .         
## Al        -0.131626300   0.18781413 -0.0954719213 -0.10535381  0.10186760
## Si         .             0.09605575 -0.0745970765  .          -0.04903652
## K          0.018687293   0.04284089  0.0742760634  0.08633151 -0.05763602
## Ca        -0.035949155   .           .             .           0.03065547
## Ba         0.129488869   .           0.0711209284  0.17168556  0.04051043
## Fe         0.213614500   0.17560249  0.1903126228  0.11109279 -0.05465663
##                                                                           
## intercept -14.04561330  6.15011644 -5.744041558 -10.388797950 -14.00215102
## RI          0.03987831 -0.06131014  0.037343816  -0.002906481   0.01259069
## Na         -0.04082279 -0.10716159  0.108753671   0.045956621  -0.08437838
## Mg          0.06665104 -0.10864675 -0.095691696   0.065915871   .         
## Al          0.04141477 -0.28646810  0.001478028   0.115194251   .         
## Si          0.07008204 -0.18170289 -0.046302771   .             0.07876168
## K           0.10480134 -0.05285187  .             0.022790900   0.03191364
## Ca          .           .          -0.145409099   0.020817468   0.01998781
## Ba          0.16168526 -0.17323288 -0.266665679   0.053206168   0.06185416
## Fe         -0.25943579  0.50140391  0.424204239   0.479729654  -0.28877808
##                                                                           
## intercept -11.997564818 -7.400289442 -6.95692998 -10.875243790 -4.77157851
## RI          0.024534161 -0.009349381 -0.02812976   .           -0.05940337
## Na          0.028375323 -0.131968711 -0.09627273   0.024130487  0.08813879
## Mg          .            0.025467477 -0.08375035  -0.009471366  .         
## Al          0.086777593 -0.058576967 -0.13154064  -0.175632060 -0.07290390
## Si          0.036752009  .            .            0.021492324 -0.09414510
## K          -0.006023420 -0.087721805 -0.03226924  -0.007637815 -0.01531661
## Ca         -0.043503918  .           -0.06097037   .            0.14603461
## Ba         -0.269177440 -0.007119144 -0.01157033   0.086541428  0.02168770
## Fe         -0.009020072 -0.206904194  0.14275798  -0.059001691  0.06275530
##                                                                         
## intercept  5.45426965 -21.03481555 -19.51302975  6.22955179 -17.37382027
## RI        -0.06891433  -0.04471836   0.04149621 -0.02698654   0.02173262
## Na        -0.11143533   0.11531730   0.05095834 -0.12897775   0.03236760
## Mg        -0.01761081   0.14325244   0.04142130 -0.06879188   0.13850188
## Al        -0.16196410   0.12211061   0.17193553 -0.14396302   0.09929165
## Si        -0.17682338   0.11334674   0.12702389 -0.17193649   0.09866454
## K         -0.08970460  -0.01890597  -0.04495758 -0.25200970   0.11015238
## Ca         .            0.16220024   .          -0.07718319   .         
## Ba         0.08299312  -0.01619285   0.07950144 -0.04068764   0.09340528
## Fe        -0.14154896   0.33374661   0.39262672  0.39989502   0.68428741
##                                                                           
## intercept -10.00154620 -17.08140154 -11.61648131 -13.09816045 -8.173982224
## RI         -0.01268900   0.03876971   0.02661184  -0.01505509  .          
## Na          .            0.13032684   0.07792747   .           .          
## Mg          0.03959575   0.03660090   .            .          -0.011202075
## Al         -0.01567141   0.36304798  -0.13012148   .          -0.197577199
## Si          .            0.07586453   0.03059779   0.05342812 -0.012043500
## K           0.08103070  -0.06270355   0.08376473   .           0.097259193
## Ca          0.06911009   .           -0.08482164   .           0.009576295
## Ba          0.08345350  -0.41739146  -0.05385915  -0.02722664  0.045516822
## Fe          0.49174919   0.56447301   0.50376848   .           0.140985634
##                              
## intercept -15.34886360 ......
## RI          .          ......
## Na          .          ......
## Mg          0.01352545 ......
## Al         -0.02962130 ......
## Si          0.07536729 ......
## K           0.02199088 ......
## Ca          0.07443468 ......
## Ba          0.08833227 ......
## Fe          0.07504949 ......
## 
##  .....suppressing columns in show(); maybe adjust &#39;options(max.print= *, width = *)&#39;
##  ..............................</code></pre>
</div>
<div id="large-sample-size-large-number-of-features" class="section level2">
<h2>large sample size, large number of features</h2>
<pre class="r"><code>cl &lt;- makeCluster(parallel::detectCores(),type=ifelse(.Platform$OS.type==&quot;unix&quot;,&quot;FORK&quot;,&quot;PSOCK&quot;))
print(cl)</code></pre>
<pre><code>## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre class="r"><code>covars &lt;- do.call(rbind, replicate(10, fgl[,1:9], simplify=FALSE))
dim(covars)</code></pre>
<pre><code>## [1] 2140    9</code></pre>
<pre class="r"><code>head(covars)</code></pre>
<pre><code>##      RI    Na   Mg   Al    Si    K   Ca Ba   Fe
## 1  3.01 13.64 4.49 1.10 71.78 0.06 8.75  0 0.00
## 2 -0.39 13.89 3.60 1.36 72.73 0.48 7.83  0 0.00
## 3 -1.82 13.53 3.55 1.54 72.99 0.39 7.78  0 0.00
## 4 -0.34 13.21 3.69 1.29 72.61 0.57 8.22  0 0.00
## 5 -0.58 13.27 3.62 1.24 73.08 0.55 8.07  0 0.00
## 6 -2.04 12.79 3.61 1.62 72.97 0.64 8.07  0 0.26</code></pre>
<pre class="r"><code>counts &lt;- matrix(sample(1:10, 2140*10000, replace=TRUE), 2140, 10000)
dim(counts)</code></pre>
<pre><code>## [1]  2140 10000</code></pre>
<pre class="r"><code>counts[1:5,1:5]</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    8    4    2    6   10
## [2,]    9    1    6    5    6
## [3,]    8    3    2    7    3
## [4,]    2    1    3    3   10
## [5,]    3    2    3    2    5</code></pre>
<pre class="r"><code>system.time(fits &lt;- dmr(cl, covars, counts, verb=1))</code></pre>
<pre><code>## fitting 2140 observations on 10000 categories, 9 covariates.
## converting counts matrix to column list...
## distributed run.
## socket cluster with 4 nodes on host &#39;localhost&#39;</code></pre>
<pre><code>##    user  system elapsed 
##   3.275   2.437 179.029</code></pre>
<pre class="r"><code>stopCluster(cl)</code></pre>
<pre class="r"><code>coef(fits)</code></pre>
<pre><code>## Warning in `[&lt;-`(`*tmp*`, sapply(B, is.null), value = &lt;S4 object of class
## structure(&quot;dsCMatrix&quot;, package = &quot;Matrix&quot;)&gt;): implicit list embedding of S4
## objects is deprecated</code></pre>
<pre><code>## 10 x 10000 sparse Matrix of class &quot;dmrcoef&quot;</code></pre>
<pre><code>##    [[ suppressing 31 column names &#39;1&#39;, &#39;2&#39;, &#39;3&#39; ... ]]</code></pre>
<pre><code>##                                                                
## intercept -9.198001 -9.201237504 -9.20729980 -9.22703 -9.218772
## RI         .         .            .           .        .       
## Na         .         .            .           .        .       
## Mg         .         .            .           .        .       
## Al         .         0.009230879  .           .        .       
## Si         .         .            .           .        .       
## K          .        -0.026093449  .           .        .       
## Ca         .         .            .           .        .       
## Ba         .         .            .           .        .       
## Fe         .         0.069822503  0.05949632  .        .       
##                                                                    
## intercept -9.23692348 -9.42685431 -9.214327 -9.20284044 -9.20013418
## RI         .           .           .         .           .         
## Na         .           0.01587629  .         .           .         
## Mg         0.01112358  .           .         .           .         
## Al         .           .           .        -0.01688486  .         
## Si         .           .           .         .           .         
## K         -0.01011264  .           .         0.02178534  .         
## Ca         .           .           .         .           .         
## Ba         .           .           .         .           0.01631387
## Fe         .           .           .        -0.24433775  .         
##                                                                      
## intercept -8.853745845 -9.46106660 -9.18317233 -9.250275 -6.683475387
## RI         0.004248093  .           .           .        -0.012382852
## Na        -0.026994442  0.02502026  .           .         0.003496068
## Mg         .           -0.01116782  .           .        -0.005456925
## Al         .           -0.04796867  .           .         .          
## Si         .            .           .           .        -0.035083185
## K          .            0.02017921  .           .        -0.028662532
## Ca         .            .           .           .         .          
## Ba         0.013906015 -0.02899167  .           .         .          
## Fe         .            0.11139131 -0.08202942  .         0.113679056
##                                                                        
## intercept -9.203976 -9.212258340 -9.414403771 -8.069354344 -9.425927582
## RI         .         0.005742068 -0.004599193  .           -0.003310477
## Na         .         .            0.014353439  .            0.015742725
## Mg         .        -0.010867647  .            0.007416378  .          
## Al         .         0.009567433  .            .            .          
## Si         .         .            .           -0.015914532  .          
## K          .         0.024123075  .            .            .          
## Ca         .         .            .            .           -0.001293414
## Ba         .         0.005130861 -0.012618560  .            .          
## Fe         .         .            0.155822812  .            .          
##                                                                    
## intercept -10.678012711 -9.219029 -9.219029 -9.205666 -10.140836319
## RI          0.008651088  .         .         .          .          
## Na          .            .         .         .         -0.011180399
## Mg          .            .         .         .          0.008223046
## Al         -0.011636731  .         .         .         -0.015796794
## Si          0.019417521  .         .         .          0.015079942
## K           0.030059049  .         .         .         -0.016307545
## Ca          0.008109445  .         .         .          .          
## Ba          .            .         .         .          .          
## Fe         -0.105965647  .         .         .         -0.048204506
##                                                                 
## intercept -9.229097561 -9.202795 -9.221432 -9.226253 -10.1492042
## RI        -0.002958273  .         .         .          .        
## Na         .            .         .         .          .        
## Mg         0.010833894  .         .         .          .        
## Al         .            .         .         .          .        
## Si         .            .         .         .          0.0127175
## K          .            .         .         .          .        
## Ca         .            .         .         .          .        
## Ba         0.036019937  .         .         .          .        
## Fe        -0.162695400  .         .         .          .        
##                             
## intercept -9.17407077 ......
## RI         .          ......
## Na         .          ......
## Mg         .          ......
## Al         .          ......
## Si         .          ......
## K         -0.03019676 ......
## Ca         .          ......
## Ba         .          ......
## Fe         .          ......
## 
##  .....suppressing columns in show(); maybe adjust &#39;options(max.print= *, width = *)&#39;
##  ..............................</code></pre>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.3.3 (2017-03-06)
## Platform: x86_64-apple-darwin13.4.0 (64-bit)
## Running under: macOS Sierra 10.12.5
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] MASS_7.3-45   distrom_0.3-3 gamlr_1.13-3  Matrix_1.2-10
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.12    lattice_0.20-34 digest_0.6.12   rprojroot_1.2  
##  [5] grid_3.3.3      backports_1.0.5 magrittr_1.5    evaluate_0.10  
##  [9] stringi_1.1.5   rmarkdown_1.6   tools_3.3.3     stringr_1.2.0  
## [13] yaml_2.1.14     htmltools_0.3.6 knitr_1.16</code></pre>
</div>

<hr>
<p>
    This <a href="http://rmarkdown.rstudio.com">R Markdown</a> site was created with <a href="https://github.com/jdblischak/workflowr">workflowr</a>
</p>
<hr>

<!-- To enable disqus, uncomment the section below and provide your disqus_shortname -->

<!-- disqus
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rmarkdown'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
-->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
